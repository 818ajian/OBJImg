!function(self){"use strict";var l=void 0===self.document?!0:!1,s=0==l?Array.prototype.slice.call(document.querySelectorAll("script")).pop().src.split(/\//g).slice(0,-1).join("/")+"/":"",a="undefined"==typeof THREE?!1:!0;if(0==l)var u=new Blob(["("+function(e){importScripts(e+"objimg.js"),this.addEventListener("message",function(e){var t=e.data.action;if("convertIMG"==t){var a=OBJImg.convertIMG(e.data.content);postMessage({action:e.data.action,content:a})}else if("convertOBJ"==t){var a=OBJImg.convertOBJ(e.data.content[0],e.data.content[1]);postMessage({action:e.data.action,content:a},[a.buffer])}},!1)}.toString()+")('"+s+"')"]),o=window.URL.createObjectURL(u);var e=65280,r=4,t=3,n=3,m=3,i=2,OBJImg=function(e){return new OBJImg.fn.init(e)};OBJImg.fn=OBJImg.prototype={constructor:OBJImg,init:function(e){if(this.datas=null,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.object3D=a?new self.THREE.Object3D:null,this.updateObject3D=!1,this.simpleObject3D=a?new self.THREE.Object3D:null,this.updateSimpleObject3D=!1,this.onComplete=null,1==e.useWorker){var t=new Worker(o);t.addEventListener("message",function(a){var t=a.data.action;"convertIMG"==t&&(this.datas=a.data.content,1==this.updateObject3D&&this.setObject3D(e),1==this.updateSimpleObject3D&&this.setSimpleObject3D(e),e.onLoad instanceof Function&&e.onLoad(this.datas))}.bind(this),!1),t.addEventListener("error",function(a){e.onError instanceof Function&&e.onError("worker error")}.bind(this),!1)}if(e.image instanceof Image)if(this.basePath=e.image.getAttribute("src").split("/").slice(0,-1).join("/")+"/",1==e.image.complete)if(1==e.useWorker){var n=new Int16Array(this.getPixels(e.image));t.postMessage({action:"convertIMG",content:n},[n.buffer])}else this.datas=OBJImg.convertIMG(this.getPixels(e.image)),1==this.updateObject3D&&this.setObject3D(e),1==this.updateSimpleObject3D&&this.setSimpleObject3D(e),e.onLoad instanceof Function&&e.onLoad(this.datas);else e.image.addEventListener("load",function(n){if(1==e.useWorker){var a=new Int16Array(this.getPixels(r));t.postMessage({action:"convertIMG",content:a},[a.buffer])}else this.datas=OBJImg.convertIMG(this.getPixels(e.image)),1==this.updateObject3D&&this.setObject3D(e),1==this.updateSimpleObject3D&&this.setSimpleObject3D(e),e.onLoad instanceof Function&&e.onLoad(this.datas)}.bind(this),!1);else{this.basePath=e.image.split("/").slice(0,-1).join("/")+"/";var r=new Image;r.addEventListener("load",function(n){if(1==e.useWorker){var a=new Int16Array(this.getPixels(r));t.postMessage({action:"convertIMG",content:a},[a.buffer])}else this.datas=OBJImg.convertIMG(this.getPixels(r)),1==this.updateObject3D&&this.setObject3D(e),1==this.updateSimpleObject3D&&this.setSimpleObject3D(e),e.onLoad instanceof Function&&e.onLoad(this.datas)}.bind(this),!1),r.src=e.image}return this},getPixels:function(e){return this.canvas.width=e.naturalWidth,this.canvas.height=e.naturalHeight,this.context.drawImage(e,0,0,e.naturalWidth,e.naturalHeight),this.context.getImageData(0,0,e.naturalWidth,e.naturalHeight).data},setObject3D:function(O){if(null!=this.datas&&1==a){self.datas=this.datas;for(var b=0,S=this.datas.objects.length;S>b;b++){for(var y=this.datas.objects[b],F=this.datas.vertices,f=this.datas.normals,s=this.datas.textures,r=new THREE.Geometry,n=new Array,w=0,I=y.faces.length;I>w;w++){var C=y.faces[w],t=C.vertices,T=C.normals,h=C.textures,v=n.indexOf(t.a);if(-1==v){v=n.push(t.a)-1;var d=F[t.a];r.vertices.push(new THREE.Vector3(d.x,d.y,d.z))}var g=n.indexOf(t.b);if(-1==g){g=n.push(t.b)-1;var x=F[t.b];r.vertices.push(new THREE.Vector3(x.x,x.y,x.z))}var V=n.indexOf(t.c);if(-1==V){V=n.push(t.c)-1;var E=F[t.c];r.vertices.push(new THREE.Vector3(E.x,E.y,E.z))}var D=null;if(f.length>0&&(D=[f[T.a],f[T.b],f[T.c]]),r.faces.push(new THREE.Face3(v,g,V,D)),s.length>0){var H=s[h.a],j=s[h.b],R=s[h.c];r.faceVertexUvs[0].push([new THREE.Vector2(H.u,H.v),new THREE.Vector2(j.u,j.v),new THREE.Vector2(R.u,R.v)])}}var e=this.datas.materials[y.material],P=null;if(void 0!=e){var p=null,l=new THREE.TextureLoader;null!=e.diffuse.map&&(p=l.load(this.basePath+e.diffuse.map),p.wrapS=p.wrapT=1==e.diffuse.clamp?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping);var c=null;null!=e.ambient.map&&(c=l.load(this.basePath+e.ambient.map),c.wrapS=c.wrapT=1==e.ambient.clamp?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping);var m=null;null!=e.specular.map&&(m=l.load(this.basePath+e.specular.map),m.wrapS=m.wrapT=1==e.specular.clamp?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping);var u=null;null!=e.bump.map&&(u=l.load(this.basePath+e.bump.map),u.wrapS=u.wrapT=1==e.normal.clamp?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping);var i=null;null!=e.bump.map&&(i=l.load(this.basePath+e.bump.map),i.wrapS=i.wrapT=1==e.bump.clamp?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping);var o=null;null!=e.opacity.map&&(o=l.load(this.basePath+e.opacity.map),o.wrapS=o.wrapT=1==e.opacity.clamp?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping),P=new THREE.MeshPhongMaterial({color:new THREE.Color(e.diffuse.r,e.diffuse.g,e.diffuse.b),aoMap:c,map:p,specular:new THREE.Color(e.specular.r,e.specular.g,e.specular.b),specularMap:m,shininess:e.specular.force,normalMap:u,normalScale:new THREE.Vector2(1,1),bumpMap:i,bumpScale:1,opacity:e.opacity.value,alphaTest:0,alphaMap:o,transparent:e.opacity.value<1||null!=o?!0:!1,combine:THREE.MultiplyOperation,shading:1==e.smooth?THREE.SmoothShading:THREE.FlatShading,fog:!0})}else P=new THREE.MeshPhongMaterial({color:new THREE.Color(.4,.4,.4),specular:new THREE.Color(1,1,1),shininess:10,fog:!0});var M=new THREE.Mesh(r,P);M.castShadow=O.castShadow,M.receiveShadow=O.receiveShadow,this.object3D.add(M)}this.onComplete instanceof Function&&this.onComplete(this.object3D)}return this},getObject3D:function(e){return this.updateObject3D=!0,this.onComplete=e,this.object3D},setSimpleObject3D:function(){if(null!=this.datas&&1==a){for(var t=new THREE.Geometry,r=0,i=this.datas.vertices.length;i>r;r++)t.vertices.push(new THREE.Vector3(this.datas.vertices[r].x,this.datas.vertices[r].y,this.datas.vertices[r].z));for(var e=0,i=this.datas.faces.length;i>e;e++){var c=this.datas.faces[e].vertices.a,u=this.datas.faces[e].vertices.b,p=this.datas.faces[e].vertices.c,s=null;if(this.datas.normals.length>0&&(s=[this.datas.normals[this.datas.faces[e].normals.a],this.datas.normals[this.datas.faces[e].normals.b],this.datas.normals[this.datas.faces[e].normals.c]]),t.faces.push(new THREE.Face3(c,u,p,s)),this.datas.textures.length>0){var n=this.datas.textures[this.datas.faces[e].textures.a],l=this.datas.textures[this.datas.faces[e].textures.b],o=this.datas.textures[this.datas.faces[e].textures.c];n&&l&&o&&t.faceVertexUvs[0].push([new THREE.Vector2(n.u,n.v),new THREE.Vector2(l.u,l.v),new THREE.Vector2(o.u,o.v)])}}t.computeBoundingBox();var m=new THREE.Mesh(t,new THREE.MeshPhongMaterial);this.object3D.add(m),this.onComplete instanceof Function&&this.onComplete(this.object3D)}return this},getSimpleObject3D:function(e){return this.updateSimpleObject3D=!0,this.onComplete=e,this.object3D},getPixelColor:function(a,e){return e=e||this.pixels,{r:e[a*r],g:e[a*r+1],b:e[a*r+2],a:e[a*r+3]}},getPixelValue:function(t,e){e=e||this.pixels;var a=this.getPixelColor(t,e);return a.r*a.g+a.b},getColorFromValue:function(t){var e=Math.min(Math.floor(t/255),255),a=e>0?255:0,r=Math.floor(t-a*e),n=a*e+r>0?255:0;return{r:a,g:e,b:r,a:n}},getValueFromColor:function(e,a,t,r){return e*a+t}},OBJImg.fn.init.prototype=OBJImg.fn,OBJImg.generateOBJ=function(e,a){},OBJImg.dictionnary="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_.-0123456789",OBJImg.convertIMG=function(r){for(var a=0,o=OBJImg.fn.getPixelValue(a++,r),u=OBJImg.fn.getPixelValue(a++,r),f=OBJImg.fn.getPixelValue(a++,r),ee=OBJImg.fn.getPixelValue(a++,r),L=0,n=0;o>n;n++)L+=OBJImg.fn.getPixelValue(a++,r);for(var b=new Array(L),D=0,n=0;u>n;n++)D+=OBJImg.fn.getPixelValue(a++,r);for(var v=new Array(D),z=0,n=0;f>n;n++)z+=OBJImg.fn.getPixelValue(a++,r);for(var C=new Array(z),$=0,n=0;ee>n;n++)$+=OBJImg.fn.getPixelValue(a++,r);for(var h=new Array($),x=new Array(OBJImg.fn.getPixelValue(a++,r)),M=0,p=x.length;p>M;M++){for(var Ee=OBJImg.fn.getPixelValue(a++,r),Ve=1==OBJImg.fn.getPixelValue(a++,r)?!0:!1,P=OBJImg.fn.getPixelColor(a++,r),xe=OBJImg.fn.getPixelValue(a++,r),be=1==OBJImg.fn.getPixelValue(a++,r)?!0:!1,Y="",l=0;xe>l;l++)Y+=OBJImg.dictionnary[OBJImg.fn.getPixelValue(a++,r)];for(var d=OBJImg.fn.getPixelColor(a++,r),de=OBJImg.fn.getPixelValue(a++,r),j="",ve=1==OBJImg.fn.getPixelValue(a++,r)?!0:!1,l=0;de>l;l++)j+=OBJImg.dictionnary[OBJImg.fn.getPixelValue(a++,r)];for(var T=OBJImg.fn.getPixelColor(a++,r),he=OBJImg.fn.getPixelValue(a++,r),I="",ge=1==OBJImg.fn.getPixelValue(a++,r)?!0:!1,l=0;he>l;l++)I+=OBJImg.dictionnary[OBJImg.fn.getPixelValue(a++,r)];for(var fe=OBJImg.fn.getPixelValue(a++,r),W="",ae=1==OBJImg.fn.getPixelValue(a++,r)?!0:!1,l=0;fe>l;l++)W+=OBJImg.dictionnary[OBJImg.fn.getPixelValue(a++,r)];for(var ue=OBJImg.fn.getPixelValue(a++,r)/(e/1e3),Me=OBJImg.fn.getPixelValue(a++,r),N="",se=1==OBJImg.fn.getPixelValue(a++,r)?!0:!1,l=0;Me>l;l++)N+=OBJImg.dictionnary[OBJImg.fn.getPixelValue(a++,r)];for(var ie=OBJImg.fn.getPixelValue(a++,r),J="",oe=1==OBJImg.fn.getPixelValue(a++,r)?!0:!1,l=0;ie>l;l++)J+=OBJImg.dictionnary[OBJImg.fn.getPixelValue(a++,r)];for(var le=OBJImg.fn.getPixelValue(a++,r)/255,ne=OBJImg.fn.getPixelValue(a++,r),X="",te=1==OBJImg.fn.getPixelValue(a++,r)?!0:!1,l=0;ne>l;l++)X+=OBJImg.dictionnary[OBJImg.fn.getPixelValue(a++,r)];x[M]={illumination:Ee,smooth:Ve,ambient:{map:Y||null,clamp:be||!1,r:P.r/255,g:P.g/255,b:P.b/255},diffuse:{map:j||null,clamp:ve||!1,r:d.r/255,g:d.g/255,b:d.b/255},specular:{map:I||null,clamp:ge||!1,forceMap:W||null,forceClamp:ae||null,force:ue,r:T.r/255,g:T.g/255,b:T.b/255},normal:{map:N||null,clamp:se||!1},bump:{map:J||null,clamp:oe||!1},opacity:{map:X||null,clamp:te||!1,value:le}}}var s=OBJImg.fn.getPixelValue(a++,r);if(v.length>0)var F=OBJImg.fn.getPixelValue(a++,r),Z=OBJImg.fn.getPixelValue(a++,r)/F;for(var c=new Array(OBJImg.fn.getPixelValue(a++,r)),m=0,p=c.length;p>m;m++){for(var K=0,n=0;ee>n;n++)K+=OBJImg.fn.getPixelValue(a++,r);var pe=0==OBJImg.fn.getPixelColor(a,r).a?!1:!0,re=OBJImg.fn.getPixelValue(a++,r);c[m]={index:K,faces:new Array,material:1==pe?re:null}}for(var y={x:OBJImg.fn.getPixelValue(a++,r)/s,y:OBJImg.fn.getPixelValue(a++,r)/s,z:OBJImg.fn.getPixelValue(a++,r)/s},w=0,p=b.length;p>w;w++,a+=t){var U=OBJImg.fn.getPixelValue(a,r)/s-y.x,G=OBJImg.fn.getPixelValue(a+1,r)/s-y.y,B=OBJImg.fn.getPixelValue(a+2,r)/s-y.z;b[w]={x:U,y:G,z:B}}for(var E=0,p=v.length;p>E;E++,a+=i){var me=OBJImg.fn.getPixelValue(a,r)/F-Z,ce=OBJImg.fn.getPixelValue(a+1,r)/F-Z;v[E]={u:me,v:ce}}for(var V=0,p=C.length;p>V;V++,a+=t){var U=OBJImg.fn.getPixelValue(a,r)/s-1,G=OBJImg.fn.getPixelValue(a+1,r)/s-1,B=OBJImg.fn.getPixelValue(a+2,r)/s-1;C[V]={x:U,y:G,z:B}}for(var g=0,p=h.length;p>g;g++,a+=3*o+3*u+3*f){for(var S=0,O=0,H=0,n=0;o>n;n++)S+=OBJImg.fn.getPixelValue(a+n,r),O+=OBJImg.fn.getPixelValue(a+o+n,r),H+=OBJImg.fn.getPixelValue(a+2*o+n,r);for(var R=0,Q=0,_=0,n=0;u>n;n++)R+=OBJImg.fn.getPixelValue(a+3*o+n,r),Q+=OBJImg.fn.getPixelValue(a+3*o+u+n,r),_+=OBJImg.fn.getPixelValue(a+3*o+2*u+n,r);for(var k=0,A=0,q=0,n=0;f>n;n++)k+=OBJImg.fn.getPixelValue(a+3*o+3*u+n,r),A+=OBJImg.fn.getPixelValue(a+3*o+3*u+f+n,r),q+=OBJImg.fn.getPixelValue(a+3*o+3*u+2*f+n,r);h[g]={vertices:{a:S,b:O,c:H},textures:{a:R,b:Q,c:_},normals:{a:k,b:A,c:q}};for(var m=c.length-1;m>=0;m--)if(g>=c[m].index){c[m].faces.push(h[g]);break}}return{vertices:b,textures:v,normals:C,faces:h,materials:x,objects:c}},OBJImg.generateIMG=function(e){var c=!/[\n\s]/.test(e.obj),a=document.createElement("canvas"),t=a.getContext("2d");if(1==e.useWorker){var r=new Worker(o);r.addEventListener("message",function(n){if("convertOBJ"==n.data.action){var l=n.data.content,r=Math.ceil(Math.sqrt(l.length/4)),o=t.createImageData(r,r);o.data.set(l),a.width=a.height=r,t.putImageData(o,0,0),e.done instanceof Function&&e.done(a.toDataURL("image/png",1))}},!1),r.addEventListener("error",function(a){e.onError instanceof Function&&e.onError("worker error")},!1)}if(1==c){var n=new XMLHttpRequest;n.addEventListener("readystatechange",function(m){if(4==this.readyState&&this.status>=200&&this.status<400){var n=this.responseText,i=e.mtl||(n.match(/(?:\n|^)\s*mtllib\s([^\n\r]+)/)||[])[1];if(void 0!=i){var l=new XMLHttpRequest;l.addEventListener("readystatechange",function(u){if(4==this.readyState&&this.status>=200&&this.status<400){var o=this.responseText;if(1==e.useWorker)r.postMessage({action:"convertOBJ",content:[n,o]});else{var i=OBJImg.convertOBJ(n,o),l=Math.ceil(Math.sqrt(i.length/4)),s=t.createImageData(l,l);s.data.set(i),a.width=a.height=l,t.putImageData(s,0,0),e.done(a.toDataURL("image/png",1))}}else 4==this.readyState&&e.error("Cant load mtl")},!1),l.open("GET",e.obj.split("/").slice(0,-1).join("/")+"/"+i,!0),l.send(null)}else if(1==e.useWorker)r.postMessage({action:"convertOBJ",content:[n,""]});else{var s=OBJImg.convertOBJ(n,""),o=Math.ceil(Math.sqrt(s.length/4)),u=t.createImageData(o,o);u.data.set(s),a.width=a.height=o,t.putImageData(u,0,0),e.done(a.toDataURL("image/png",1))}}else 4==this.readyState&&e.error("Cant load obj")},!1),n.open("GET",e.obj,!0),n.send(null)}else{var i=e.obj||"",s=e.mtl||"";if(1==e.useWorker)r.postMessage({action:"convertOBJ",content:[i,s]});else{var u=OBJImg.convertOBJ(i,s),l=Math.ceil(Math.sqrt(u.length/4)),m=t.createImageData(l,l);m.data.set(u),a.width=a.height=l,t.putImageData(m,0,0),e.done(a.toDataURL("image/png",1))}}return this},OBJImg.convertOBJ=function(Va,va){for(var aa=va.split(/\n/g),l=new Array,Ke=new Array,z=0,M=aa.length,c=-1;M>z;z++){var u=aa[z].split(/\s+(?!$)/g),v=u[0].replace(/\s+/,"").toLowerCase();if("newmtl"==v)c++,Ke[c]=u[1],l[c]={illumination:2,smooth:!0,ambient:{map:[],clamp:!1,r:1,g:1,b:1},diffuse:{map:[],clamp:!1,r:1,g:1,b:1},specular:{map:[],clamp:!1,forceMap:[],forceClamp:!1,force:1,r:1,g:1,b:1},normal:{map:[],clamp:!1},bump:{map:[],clamp:!1},opacity:{map:[],clamp:!1,value:1}};else if("ka"==v)l[c].ambient.r=parseFloat(u[1]),l[c].ambient.g=parseFloat(u[2]),l[c].ambient.b=parseFloat(u[3]);else if("kd"==v)l[c].diffuse.r=parseFloat(u[1]),l[c].diffuse.g=parseFloat(u[2]),l[c].diffuse.b=parseFloat(u[3]);else if("ks"==v)l[c].specular.r=parseFloat(u[1]),l[c].specular.g=parseFloat(u[2]),l[c].specular.b=parseFloat(u[3]);else if("ns"==v)l[c].specular.force=parseFloat(u[1]);else if("d"==v)l[c].opacity.value=parseFloat(u[1]);else if("illum"==v)l[c].illumination=parseInt(u[1]);else if("s"==v)l[c].smooth="off"==u[1]||0==parseInt(u[1])?!1:!0;else if("ni"==v);else if("map"==v.substr(0,3)&&u.length>1){var Se=u[u.length-1]||null,R=new Array;if(null!=Se)for(var h=0,P=Se.length;P>h;h++)R[h]=OBJImg.dictionnary.indexOf(Se[h]);for(var H={clamp:!0},Me=1,xa=u.length;xa>Me;Me++){var ba=u[Me];if("-clamp"==ba){var Qe=u[++Me];("off"==Qe||0==parseInt(Qe))&&(H.clamp=!1)}}"map_ka"==v?(l[c].ambient.map=R,l[c].ambient.clamp=H.clamp):"map_kd"==v?(l[c].diffuse.map=R,l[c].diffuse.clamp=H.clamp):"map_ks"==v?(l[c].specular.map=R,l[c].specular.clamp=H.clamp):"map_ns"==v?(l[c].specular.forceMap=R,l[c].specular.forceClamp=H.clamp):"map_kn"==v?(l[c].normal.map=R,l[c].normal.clamp=H.clamp):"map_bump"==v?(l[c].bump.map=R,l[c].bump.clamp=H.clamp):"map_d"==v&&(l[c].opacity.map=R,l[c].opacity.clamp=H.clamp)}}for(var ea=Va.split(/\n/g),E=new Array,j=new Array,O=new Array,T=new Array,d=new Array,s={vertex:{min:{x:1/0,y:1/0,z:1/0,w:1/0},max:{x:-(1/0),y:-(1/0),z:-(1/0),w:-(1/0)}},texture:{min:1/0,max:-(1/0)}},z=0,M=ea.length;M>z;z++){var u=ea[z].split(/\s+/g),v=u[0].toLowerCase();if("v"==v){var U=parseFloat(u[1]),J=parseFloat(u[2]),k=parseFloat(u[3]);U<s.vertex.min.x&&(s.vertex.min.x=U),U>s.vertex.max.x&&(s.vertex.max.x=U),J<s.vertex.min.y&&(s.vertex.min.y=J),J>s.vertex.max.y&&(s.vertex.max.y=J),k<s.vertex.min.z&&(s.vertex.min.z=k),k>s.vertex.max.z&&(s.vertex.max.z=k),j.push({x:U,y:J,z:k})}else if("vt"==v){var Ie=parseFloat(u[1]),Oe=parseFloat(u[2]),Ye=Math.min(Ie,Oe),Ze=Math.max(Ie,Oe);Ye<s.texture.min&&(s.texture.min=Ye),Ze>s.texture.max&&(s.texture.max=Ze),O.push({u:Ie,v:Oe})}else if("vn"==v)T.push({x:parseFloat(u[1]),y:parseFloat(u[2]),z:parseFloat(u[3])});else if("f"==v){var De=u[1].split(/\//g),He=u[2].split(/\//g),je=u[3].split(/\//g),na=parseInt(De[0])-1,oa=parseInt(He[0])-1,sa=parseInt(je[0])-1,ma=parseInt(De[1])-1,ga=parseInt(He[1])-1,We=parseInt(je[1])-1,ze=parseInt(De[2])-1,Be=parseInt(He[2])-1,Ue=parseInt(je[2])-1;d.push({vertices:{a:isNaN(na)?null:na,b:isNaN(oa)?null:oa,c:isNaN(sa)?null:sa},textures:{a:isNaN(ma)?null:ma,b:isNaN(ga)?null:ga,c:isNaN(We)?null:We},normals:{a:isNaN(ze)?null:ze,b:isNaN(Be)?null:Be,c:isNaN(Ue)?null:Ue}})}else"o"==v||"g"==v?E.push({name:u[1],material:null,index:d.length}):"usemtl"==v&&(E[E.length-1].material=Ke.indexOf(u[1]))}s.vertex.min.w=Math.min(s.vertex.min.x,s.vertex.min.y,s.vertex.min.z),s.vertex.max.w=Math.max(s.vertex.max.x,s.vertex.max.y,s.vertex.max.z);for(var r=0,L=Math.ceil(j.length/e),x=Math.ceil(O.length/e),D=Math.ceil(T.length/e),A=Math.ceil(d.length/e),da=function(e){var a=0;for(var t in e)a+=e[t];return a}({vertexSplitting:1,textureSplitting:1,normalSplitting:1,faceSplitting:1,vertices:L,textures:x,normals:D,faces:A,materials:1+9*l.length*2,vertexMultiplicator:1,textureMultiplicator:x>0?1:0,textureOffset:x>0?1:0,objects:1+E.length*A,pivot:3}),V=da+j.length*t+O.length*i+T.length*t+(d.length*n*L+d.length*n*x+d.length*n*D),o=0,M=l.length;M>o;o++)V+=3*m,V+=l[o].ambient.map.length,V+=l[o].diffuse.map.length,V+=l[o].specular.map.length,V+=l[o].specular.forceMap.length,V+=l[o].normal.map.length,V+=l[o].bump.map.length,V+=l[o].opacity.map.length;var a=(Math.ceil(Math.sqrt(V)),new Uint8ClampedArray(4*V)),ge=OBJImg.fn.getColorFromValue(L);a[r++]=ge.r,a[r++]=ge.g,a[r++]=ge.b,a[r++]=ge.a;var ve=OBJImg.fn.getColorFromValue(x);a[r++]=ve.r,a[r++]=ve.g,a[r++]=ve.b,a[r++]=ve.a;var Ve=OBJImg.fn.getColorFromValue(D);a[r++]=Ve.r,a[r++]=Ve.g,a[r++]=Ve.b,a[r++]=Ve.a;var Ee=OBJImg.fn.getColorFromValue(A);a[r++]=Ee.r,a[r++]=Ee.g,a[r++]=Ee.b,a[r++]=Ee.a;for(var pa=0,p=0;L>p;p++){var Le=Math.min(j.length-pa,e),we=OBJImg.fn.getColorFromValue(Le);a[r++]=we.r,a[r++]=we.g,a[r++]=we.b,a[r++]=we.a,pa+=Le}for(var ta=0,p=0;x>p;p++){var Ae=Math.min(O.length-ta,e),X=OBJImg.fn.getColorFromValue(Ae);a[r++]=X.r,a[r++]=X.g,a[r++]=X.b,a[r++]=X.a,ta+=Ae}for(var Ge=0,p=0;D>p;p++){var Je=Math.min(T.length-Ge,e),K=OBJImg.fn.getColorFromValue(Je);a[r++]=K.r,a[r++]=K.g,a[r++]=K.b,a[r++]=K.a,Ge+=Je}for(var qe=0,p=0;A>p;p++){var _e=Math.min(d.length-qe,e),Q=OBJImg.fn.getColorFromValue(_e);a[r++]=Q.r,a[r++]=Q.g,a[r++]=Q.b,a[r++]=Q.a,qe+=_e}var S=OBJImg.fn.getColorFromValue(l.length);a[r++]=S.r,a[r++]=S.g,a[r++]=S.b,a[r++]=S.a;for(var o=0,M=l.length;M>o;o++){a[r++]=0,a[r++]=0,a[r++]=l[o].illumination,a[r++]=255,a[r++]=0,a[r++]=0,a[r++]=1==l[o].smooth?1:0,a[r++]=255,a[r++]=Math.round(255*l[o].ambient.r),a[r++]=Math.round(255*l[o].ambient.g),a[r++]=Math.round(255*l[o].ambient.b),a[r++]=255;var Z=OBJImg.fn.getColorFromValue(l[o].ambient.map.length);a[r++]=Z.r,a[r++]=Z.g,a[r++]=Z.b,a[r++]=Z.a,a[r++]=0,a[r++]=0,a[r++]=1==l[o].ambient.clamp?1:0,a[r++]=255;for(var h=0,P=l[o].ambient.map.length;P>h;h++){var f=OBJImg.fn.getColorFromValue(l[o].ambient.map[h]);a[r++]=f.r,a[r++]=f.g,a[r++]=f.b,a[r++]=f.a}a[r++]=Math.round(255*l[o].diffuse.r),a[r++]=Math.round(255*l[o].diffuse.g),a[r++]=Math.round(255*l[o].diffuse.b),a[r++]=255;var ee=OBJImg.fn.getColorFromValue(l[o].diffuse.map.length);a[r++]=ee.r,a[r++]=ee.g,a[r++]=ee.b,a[r++]=ee.a,a[r++]=0,a[r++]=0,a[r++]=1==l[o].diffuse.clamp?1:0,a[r++]=255;for(var h=0,P=l[o].diffuse.map.length;P>h;h++){var f=OBJImg.fn.getColorFromValue(l[o].diffuse.map[h]);a[r++]=f.r,a[r++]=f.g,a[r++]=f.b,a[r++]=f.a}a[r++]=Math.round(255*l[o].specular.r),a[r++]=Math.round(255*l[o].specular.g),a[r++]=Math.round(255*l[o].specular.b),a[r++]=255;var ae=OBJImg.fn.getColorFromValue(l[o].specular.map.length);a[r++]=ae.r,a[r++]=ae.g,a[r++]=ae.b,a[r++]=ae.a,a[r++]=0,a[r++]=0,a[r++]=1==l[o].specular.clamp?1:0,a[r++]=255;for(var h=0,P=l[o].specular.map.length;P>h;h++){var f=OBJImg.fn.getColorFromValue(l[o].specular.map[h]);a[r++]=f.r,a[r++]=f.g,a[r++]=f.b,a[r++]=f.a}var te=OBJImg.fn.getColorFromValue(l[o].specular.forceMap.length);a[r++]=te.r,a[r++]=te.g,a[r++]=te.b,a[r++]=te.a,a[r++]=0,a[r++]=0,a[r++]=1==l[o].specular.forceClamp?1:0,a[r++]=255;for(var h=0,P=l[o].specular.forceMap.length;P>h;h++){var f=OBJImg.fn.getColorFromValue(l[o].specular.forceMap[h]);a[r++]=f.r,a[r++]=f.g,a[r++]=f.b,a[r++]=f.a}var re=OBJImg.fn.getColorFromValue(l[o].specular.force*(e/1e3));a[r++]=re.r,a[r++]=re.g,a[r++]=re.b,a[r++]=re.a;var ne=OBJImg.fn.getColorFromValue(l[o].normal.map.length);a[r++]=ne.r,a[r++]=ne.g,a[r++]=ne.b,a[r++]=ne.a,a[r++]=0,a[r++]=0,a[r++]=1==l[o].normal.clamp?1:0,a[r++]=255;for(var h=0,P=l[o].normal.map.length;P>h;h++){var f=OBJImg.fn.getColorFromValue(l[o].normal.map[h]);a[r++]=f.r,a[r++]=f.g,a[r++]=f.b,a[r++]=f.a}var le=OBJImg.fn.getColorFromValue(l[o].bump.map.length);a[r++]=le.r,a[r++]=le.g,a[r++]=le.b,a[r++]=le.a,a[r++]=0,a[r++]=0,a[r++]=1==l[o].bump.clamp?1:0,a[r++]=255;for(var h=0,P=l[o].bump.map.length;P>h;h++){var f=OBJImg.fn.getColorFromValue(l[o].bump.map[h]);a[r++]=f.r,a[r++]=f.g,a[r++]=f.b,a[r++]=f.a}var oe=OBJImg.fn.getColorFromValue(255*l[o].opacity.value);a[r++]=oe.r,a[r++]=oe.g,a[r++]=oe.b,a[r++]=oe.a;var ie=OBJImg.fn.getColorFromValue(l[o].opacity.map.length);a[r++]=ie.r,a[r++]=ie.g,a[r++]=ie.b,a[r++]=ie.a,a[r++]=0,a[r++]=0,a[r++]=1==l[o].opacity.clamp?1:0,a[r++]=255;for(var h=0,P=l[o].opacity.map.length;P>h;h++){var f=OBJImg.fn.getColorFromValue(l[o].opacity.map[h]);a[r++]=f.r,a[r++]=f.g,a[r++]=f.b,a[r++]=f.a}}var W=OBJImg.fn.getColorFromValue(e/(s.vertex.max.w+Math.abs(s.vertex.min.w))),w=W.r*W.g+W.b;if(a[r++]=W.r,a[r++]=W.g,a[r++]=W.b,a[r++]=W.a,x>0){var I=OBJImg.fn.getColorFromValue(e/Math.max(s.texture.max+Math.abs(s.texture.min),1)),Re=I.r*I.g+I.b;a[r++]=I.r,a[r++]=I.g,a[r++]=I.b,a[r++]=I.a;var pe=OBJImg.fn.getColorFromValue(Math.abs(s.texture.min)*Re);a[r++]=pe.r,a[r++]=pe.g,a[r++]=pe.b,a[r++]=pe.a}var fe=OBJImg.fn.getColorFromValue(E.length);a[r++]=fe.r,a[r++]=fe.g,a[r++]=fe.b,a[r++]=fe.a;for(var N=0,M=E.length;M>N;N++){for(var ke=0,p=0;A>p;p++){var Ne=Math.min(E[N].index-ke,e),he=OBJImg.fn.getColorFromValue(Ne);a[r++]=he.r,a[r++]=he.g,a[r++]=he.b,a[r++]=he.a,ke+=Ne}if(null!=E[N].material){var S=OBJImg.fn.getColorFromValue(E[N].material);a[r++]=S.r,a[r++]=S.g,a[r++]=S.b,a[r++]=255}else a[r++]=0,a[r++]=0,a[r++]=0,a[r++]=0}var Te={x:Math.abs(s.vertex.min.x)*w,y:Math.abs(s.vertex.min.y)*w,z:Math.abs(s.vertex.min.z)*w},de=OBJImg.fn.getColorFromValue(Te.x);a[r++]=de.r,a[r++]=de.g,a[r++]=de.b,a[r++]=de.a;var be=OBJImg.fn.getColorFromValue(Te.y);a[r++]=be.r,a[r++]=be.g,a[r++]=be.b,a[r++]=be.a;var xe=OBJImg.fn.getColorFromValue(Te.z);a[r++]=xe.r,a[r++]=xe.g,a[r++]=xe.b,a[r++]=xe.a;for(var G=0,M=j.length;M>G;G++){var C=OBJImg.fn.getColorFromValue((j[G].x+Math.abs(s.vertex.min.x))*w);a[r++]=C.r,a[r++]=C.g,a[r++]=C.b,a[r++]=C.a;var y=OBJImg.fn.getColorFromValue((j[G].y+Math.abs(s.vertex.min.y))*w);a[r++]=y.r,a[r++]=y.g,a[r++]=y.b,a[r++]=y.a;var F=OBJImg.fn.getColorFromValue((j[G].z+Math.abs(s.vertex.min.z))*w);a[r++]=F.r,a[r++]=F.g,a[r++]=F.b,a[r++]=F.a}for(var ye=0,M=O.length;M>ye;ye++){var Ce=OBJImg.fn.getColorFromValue((O[ye].u+Math.abs(s.texture.min))*Re);a[r++]=Ce.r,a[r++]=Ce.g,a[r++]=Ce.b,a[r++]=Ce.a;var Fe=OBJImg.fn.getColorFromValue((O[ye].v+Math.abs(s.texture.min))*Re);a[r++]=Fe.r,a[r++]=Fe.g,a[r++]=Fe.b,a[r++]=Fe.a}for(var B=0,M=T.length;M>B;B++){var C=OBJImg.fn.getColorFromValue((T[B].x+1)*w);a[r++]=C.r,a[r++]=C.g,a[r++]=C.b,a[r++]=C.a;var y=OBJImg.fn.getColorFromValue((T[B].y+1)*w);a[r++]=y.r,a[r++]=y.g,a[r++]=y.b,a[r++]=y.a;var F=OBJImg.fn.getColorFromValue((T[B].z+1)*w);a[r++]=F.r,a[r++]=F.g,a[r++]=F.b,a[r++]=F.a}for(var b=0,M=d.length;M>b;b++){for(var g=0,p=0;L>p;p++){var ra=Math.min(d[b].vertices.a-g,e),me=OBJImg.fn.getColorFromValue(ra);a[r++]=me.r,a[r++]=me.g,a[r++]=me.b,a[r++]=me.a,g+=ra}g=0;for(var p=0;L>p;p++){var la=Math.min(d[b].vertices.b-g,e),ue=OBJImg.fn.getColorFromValue(la);a[r++]=ue.r,a[r++]=ue.g,a[r++]=ue.b,a[r++]=ue.a,g+=la}g=0;for(var p=0;L>p;p++){var ia=Math.min(d[b].vertices.c-g,e),se=OBJImg.fn.getColorFromValue(ia);a[r++]=se.r,a[r++]=se.g,a[r++]=se.b,a[r++]=se.a,g+=ia}g=0;for(var p=0;x>p;p++){var ua=Math.min(d[b].textures.a-g,e),$=OBJImg.fn.getColorFromValue(ua);a[r++]=$.r,a[r++]=$.g,a[r++]=$.b,a[r++]=$.a,g+=ua}g=0;for(var p=0;x>p;p++){var ca=Math.min(d[b].textures.b-g,e),ce=OBJImg.fn.getColorFromValue(ca);a[r++]=ce.r,a[r++]=ce.g,a[r++]=ce.b,a[r++]=ce.a,g+=ca}g=0;for(var p=0;x>p;p++){var fa=Math.min(d[b].textures.c-g,e),Pe=OBJImg.fn.getColorFromValue(fa);a[r++]=Pe.r,a[r++]=Pe.g,a[r++]=Pe.b,a[r++]=Pe.a,g+=fa}g=0;for(var p=0;D>p;p++){var ha=Math.min(d[b].normals.a-g,e),q=OBJImg.fn.getColorFromValue(ha);a[r++]=q.r,a[r++]=q.g,a[r++]=q.b,a[r++]=q.a,g+=ha}g=0;for(var p=0;D>p;p++){var $e=Math.min(d[b].normals.b-g,e),_=OBJImg.fn.getColorFromValue($e);a[r++]=_.r,a[r++]=_.g,a[r++]=_.b,a[r++]=_.a,g+=$e}g=0;for(var p=0;D>p;p++){var Xe=Math.min(d[b].normals.c-g,e),Y=OBJImg.fn.getColorFromValue(Xe);a[r++]=Y.r,a[r++]=Y.g,a[r++]=Y.b,a[r++]=Y.a,g+=Xe}}return a},"undefined"!=typeof define&&define instanceof Function&&void 0!=define.amd?define(function(){return OBJImg}):"undefined"!=typeof module&&module.exports?module.exports=OBJImg:void 0!=self&&(self.OBJImg=OBJImg)}(self);