<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>OBJImg</title>
	<style type="text/css">

		* {
			margin: 0;
			padding: 0;
			border: 0;
		}

		html {
			overflow: hidden;
			background-color: #222222;
		}

		canvas:first-child {
			width: 100%;
			height: 100%;
		}

		canvas:last-child {
			position: absolute;
			top: 0;
			left: 0;
		}

		img {
			display: block;
			position: absolute;
			top: 0;
			left: 0;
			width: 10%;
			height: auto;
		}

	</style>
	<script type="text/javascript" src="three-js-72/build/three.js"></script>
	<script type="text/javascript" src="objimg.js"></script>
	<script type="text/javascript">

		window.onload = function(){

			var width = window.innerWidth;
			var height = window.innerHeight;
			var aspect = width / height;

			var renderer = new THREE.WebGLRenderer({
				precision: "highp",
				premultipliedAlpha: true,
				alpha: true,
				antialias: true
			});

			renderer.setSize(width, height);

			document.body.appendChild(renderer.domElement);

			var camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 10000);

			window.addEventListener("resize", function( event ){

				width = window.innerWidth;
				height = window.innerHeight;

				renderer.setSize(width, height);

				camera.aspect = width / height;
				camera.updateProjectionMatrix();

			}, false);

			var scene = new THREE.Scene();

			var ambient = new THREE.AmbientLight(0x000000);
			scene.add(ambient);

			var light = new THREE.PointLight(0xFFFFFF);
			light.position.set(15, 5, 5);
			scene.add(light);

			var hemisphereLight = new THREE.HemisphereLight(0xFFFFFF, 0x001133, 1);
			scene.add(hemisphereLight);

			var image = new Image();

			var generatedObject = new Object();

			var objFile = "lara";
			var imgFile = "lara";

			var generatedMesh = null;

			// var image = OBJImg.generateImg("models/" + objFile + ".obj", function( datas ){

			// 	var image = new Image();
			// 	image.src = datas;

			// 	document.body.appendChild(image);

			// });

			new OBJImg("models/" + imgFile + ".obj.png", function( datas ){

				console.log(datas);

				var geometry = new THREE.Geometry();

				for( var vertex = 0, length = datas.vertices.length; vertex < length; vertex++ ){

					geometry.vertices.push(new THREE.Vector3(datas.vertices[vertex].x, datas.vertices[vertex].y, datas.vertices[vertex].z));

				};

				for( var face = 0, length = datas.faces.length; face < length; face++ ){

					var vertexA = datas.faces[face].vertices.a;
					var vertexB = datas.faces[face].vertices.b;
					var vertexC = datas.faces[face].vertices.c;

					var normals = null;

					if( datas.normals.length > 0 ){

						normals = [
							datas.normals[datas.faces[face].normals.a],
							datas.normals[datas.faces[face].normals.b],
							datas.normals[datas.faces[face].normals.c],
						];

					};

					geometry.faces.push(new THREE.Face3(vertexA, vertexB, vertexC, normals));

					if( datas.textures.length > 0 ){

						var uvA = datas.textures[datas.faces[face].textures.a];
						var uvB = datas.textures[datas.faces[face].textures.b];
						var uvC = datas.textures[datas.faces[face].textures.c];

						if( uvA && uvB && uvC ){

							geometry.faceVertexUvs[0].push([
								new THREE.Vector2(uvA.u, uvA.v),
								new THREE.Vector2(uvB.u, uvB.v),
								new THREE.Vector2(uvC.u, uvC.v)
							]);

						};

					};

				};

				geometry.computeBoundingBox();

				camera.position.set(0, 0, Math.abs(geometry.boundingBox.min.x - geometry.boundingBox.max.x) * 2);

				// var texture =  THREE.ImageUtils.loadTexture("textures/tree.jpg");

				var material = new THREE.MeshPhongMaterial({
					color: 0x555555,
					shading: THREE.SmoothShading
				});

				var mesh = generatedMesh = new THREE.Mesh(geometry, material);

				// var material = new THREE.PointCloudMaterial({
				// 	size: 0.01
				// });

				// var mesh = generatedMesh = new THREE.PointCloud(geometry, material);

				mesh.position.set(0, -2, 0);

				scene.add(mesh);

			});

			function render( now ){

				window.requestAnimationFrame(render);

				if( generatedMesh ){

					generatedMesh.rotateOnAxis(new THREE.Vector3(0, 1, 0), Math.PI / 180);

				};

				renderer.render(scene, camera);

			};

			window.requestAnimationFrame(render);

		};

	</script>
</head>
<body></body>
</html>